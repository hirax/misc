<!DOCTYPE html>
<html>
<head>
    <title>京都歴史散歩地図 2025/07/20</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_1617e99debc67710a7a59084ddc2d0eb {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>
</head>
<body>
    
    
            <div class="folium-map" id="map_1617e99debc67710a7a59084ddc2d0eb" ></div>
        
    
        <div style="position:absolute; bottom:20px; 
        right:10px; z-index:1000; background:
        rgba(255,255,255,0.9); padding:10px;">
            <input id="slide" type="range" 
            min="0" max="1" step="0.1" value="1" 
            onchange="updateOpacity(this.value)">
        </div>
        
    
        <input type="file" accept=".geojson,.json" 
        style="position:absolute; top:10px; 
        left:200px; z-index:1000;">
        
</body>
<script>
    
    
            var map_1617e99debc67710a7a59084ddc2d0eb = L.map(
                "map_1617e99debc67710a7a59084ddc2d0eb",
                {
                    center: [35.0116, 135.768],
                    crs: L.CRS.EPSG3857,
                    zoom: 13,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );
            L.control.scale().addTo(map_1617e99debc67710a7a59084ddc2d0eb);

            

        
    
            var tile_layer_1b034c2749981a1574174bea4dd1ca78 = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors", "detectRetina": false, "maxNativeZoom": 19, "maxZoom": 20, "minZoom": 11, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            tile_layer_1b034c2749981a1574174bea4dd1ca78.addTo(map_1617e99debc67710a7a59084ddc2d0eb);
        
    
            var tile_layer_e79812873f09e2f2957390dfc82eb7e6 = L.tileLayer(
                "https://api.rekichizu.jp/tiles/inou-2024-1125/{z}/{x}/{y}",
                {"attribution": "\u308c\u304d\u3061\u305a/\u30c7\u30b8\u30bf\u30eb\u4f0a\u80fd\u56f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_ae2895f7f59b1c3c5474f6c8b2dc6af7 = L.tileLayer(
                "https://www.dmuchgis.com/wmts/meisai_hasegawa/{z}/{x}/{y}.png",
                {"attribution": "ArcGIS\u30aa\u30f3\u30e9\u30a4\u30f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_b28c000025d9dcd9c4c653053231cc61 = L.tileLayer(
                "https://www.dmuchgis.com/wmts/meisai_sougou/{z}/{x}/{y}.png",
                {"attribution": "ArcGIS\u30aa\u30f3\u30e9\u30a4\u30f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_8ef445fac378887547af92556a8c8095 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/kasei/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_b2e5d229a756bdb4614c9f877aa64035 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/seisiki/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_46dc78b185e646a5231f5ebb12e74650 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s4/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_a70524a155c2c046f91ea67d5224e2b3 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s10/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_ee2f9cb54f02805dc2455dfc7114d96c = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s28/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_219904f5a3bdc91199c377d2a3b0d0d7 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_8e1116f23a467398a634f373c15942c5 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/ort_USA10/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_11f345d3922ec9d55be83d1d78e19ec8 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/gazo1/{z}/{x}/{y}.jpg",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_935fb7d3b6464f2eb16df93b4307ea4e = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662+GRUS\u753b\u50cf\uff08\u00a9 Axelspace\uff09", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_6acba42221d3e9c710e2a69d1d058dca = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/afm/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_c56adb93ddd585feb5e1990aa49cd657 = L.tileLayer(
                "https://www.j-shis.bosai.go.jp/map/xyz/landslide/{z}/{x}/{y}.png",
                {"attribution": "\u9632\u707d\u79d1\u5b66\u6280\u8853\u7814\u7a76\u6240", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_55a52e01831b026d15b2fe75dd742e66 = L.tileLayer(
                "https://gbank.gsj.jp/seamless/v2/api/1.3.1/tiles/{z}/{y}/{x}.png",
                {"attribution": "\u7523\u7dcf\u7814\u5730\u8cea\u8abf\u67fb\u7dcf\u5408\u30bb\u30f3\u30bf\u30fc", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    

            var geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf = {"collapsed": false, "defaultMarkGeocode": true, "position": "topright", "provider": "nominatim", "providerOptions": {}, "zoom": 11};

            // note: geocoder name should start with lowercase
            var geocoderName_geocoder_58a3901f03a46164cf246fc90b6cacaf = geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf["provider"];

            var customGeocoder_geocoder_58a3901f03a46164cf246fc90b6cacaf = L.Control.Geocoder[ geocoderName_geocoder_58a3901f03a46164cf246fc90b6cacaf ](
                geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf['providerOptions']
            );
            geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf["geocoder"] = customGeocoder_geocoder_58a3901f03a46164cf246fc90b6cacaf;

            L.Control.geocoder(
                geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf
            ).on('markgeocode', function(e) {
                var zoom = geocoderOpts_geocoder_58a3901f03a46164cf246fc90b6cacaf['zoom'] || map_1617e99debc67710a7a59084ddc2d0eb.getZoom();
                map_1617e99debc67710a7a59084ddc2d0eb.setView(e.geocode.center, zoom);
            }).addTo(map_1617e99debc67710a7a59084ddc2d0eb);

        
    
            var layer_control_2e0dbbdf787b24e7f9124b5c654feb4a_layers = {
                base_layers : {
                    "openstreetmap" : tile_layer_1b034c2749981a1574174bea4dd1ca78,
                },
                overlays :  {
                    "\u308c\u304d\u3061\u305a/\u30c7\u30b8\u30bf\u30eb\u4f0a\u80fd\u56f3" : tile_layer_e79812873f09e2f2957390dfc82eb7e6,
                    "ArcGIS\u662d\u548c26\u5e74\u9803\u4eac\u90fd\u5e02\u660e\u7d30\u56f3(\u7dcf\u5408\u8cc7\u6599\u9928\u7248)\u3010around 1951\u3011" : tile_layer_ae2895f7f59b1c3c5474f6c8b2dc6af7,
                    "ArcGIS\u662d\u548c26\u5e74\u9803\u4eac\u90fd\u5e02\u660e\u7d30\u56f3\uff08\u4eac\u90fd\u5b66\u30fb\u6b74\u5f69\u9928\uff09\u3010around 1951\u3011" : tile_layer_b28c000025d9dcd9c4c653053231cc61,
                    "\u660e\u6cbb25\u5e74(\u4eee\u88fd\u56f3)\u30101892\u3011" : tile_layer_8ef445fac378887547af92556a8c8095,
                    "\u5927\u6b63\u5143\u5e74(\u6b63\u5f0f\u56f3)\u30101912\u3011" : tile_layer_b2e5d229a756bdb4614c9f877aa64035,
                    "\u662d\u548c4\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101929\u3011" : tile_layer_46dc78b185e646a5231f5ebb12e74650,
                    "\u662d\u548c10\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101935\u3011" : tile_layer_a70524a155c2c046f91ea67d5224e2b3,
                    "\u662d\u548c28\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101953\u3011" : tile_layer_ee2f9cb54f02805dc2455dfc7114d96c,
                    "\u9670\u5f71\u8d77\u4f0f\u56f3" : tile_layer_219904f5a3bdc91199c377d2a3b0d0d7,
                    "\u7a7a\u4e2d\u5199\u771f\uff081945\u5e74\uff5e1950\u5e74\uff09" : tile_layer_8e1116f23a467398a634f373c15942c5,
                    "\u7a7a\u4e2d\u5199\u771f\uff081974\u5e74\uff5e1978\u5e74\uff09" : tile_layer_11f345d3922ec9d55be83d1d78e19ec8,
                    "\u5168\u56fd\u6700\u65b0\u5199\u771f(\u30b7\u30fc\u30e0\u30ec\u30b9)" : tile_layer_935fb7d3b6464f2eb16df93b4307ea4e,
                    "\u6d3b\u65ad\u5c64\u56f3\uff08\u90fd\u5e02\u570f\u6d3b\u65ad\u5c64\u56f3\uff09" : tile_layer_6acba42221d3e9c710e2a69d1d058dca,
                    "\u5730\u3059\u3079\u308a\u5730\u5f62\u5206\u5e03\u56f3\u65e5\u672c\u5168\u56fd\u7248" : tile_layer_c56adb93ddd585feb5e1990aa49cd657,
                    "\u5730\u8cea\u56f3" : tile_layer_55a52e01831b026d15b2fe75dd742e66,
                },
            };
            let layer_control_2e0dbbdf787b24e7f9124b5c654feb4a = L.control.layers(
                layer_control_2e0dbbdf787b24e7f9124b5c654feb4a_layers.base_layers,
                layer_control_2e0dbbdf787b24e7f9124b5c654feb4a_layers.overlays,
                {"autoZIndex": true, "collapsed": true, "position": "topright"}
            ).addTo(map_1617e99debc67710a7a59084ddc2d0eb);

        
    
            var locate_control_bcd0e9d3a81595a41c71299c7055589b = L.control.locate(
                {}
            ).addTo(map_1617e99debc67710a7a59084ddc2d0eb);
            
        
    
        function updateOpacity(value) {
            
            tile_layer_e79812873f09e2f2957390dfc82eb7e6.setOpacity(value);
            
            tile_layer_ae2895f7f59b1c3c5474f6c8b2dc6af7.setOpacity(value);
            
            tile_layer_b28c000025d9dcd9c4c653053231cc61.setOpacity(value);
            
            tile_layer_8ef445fac378887547af92556a8c8095.setOpacity(value);
            
            tile_layer_b2e5d229a756bdb4614c9f877aa64035.setOpacity(value);
            
            tile_layer_46dc78b185e646a5231f5ebb12e74650.setOpacity(value);
            
            tile_layer_a70524a155c2c046f91ea67d5224e2b3.setOpacity(value);
            
            tile_layer_ee2f9cb54f02805dc2455dfc7114d96c.setOpacity(value);
            
            tile_layer_219904f5a3bdc91199c377d2a3b0d0d7.setOpacity(value);
            
            tile_layer_8e1116f23a467398a634f373c15942c5.setOpacity(value);
            
            tile_layer_11f345d3922ec9d55be83d1d78e19ec8.setOpacity(value);
            
            tile_layer_935fb7d3b6464f2eb16df93b4307ea4e.setOpacity(value);
            
            tile_layer_6acba42221d3e9c710e2a69d1d058dca.setOpacity(value);
            
            tile_layer_c56adb93ddd585feb5e1990aa49cd657.setOpacity(value);
            
            tile_layer_55a52e01831b026d15b2fe75dd742e66.setOpacity(value);
            
        }
        
    
        var input=document.querySelector('input[type="file"]');
        input.addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
            try {
            var geojsonData = JSON.parse(e.target.result);
                    L.geoJSON(geojsonData, {
                        style: function(feature) {
                            return {
                                fillColor: 'blue',
                                color: 'blue',
                                weight: 5,
                                fillOpacity: 0.8
                            };
                        }
                    }).addTo(map_1617e99debc67710a7a59084ddc2d0eb);
                } catch (error) {
                    alert(error.message);
                }
            };
            reader.readAsText(file);
        });
        
    
        let path = [];
        let watchId = null;
        function handleLocationUpdate(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const timestamp = new Date().toISOString();
            path.push([lat, lng]);
            const polyline = L.polyline(path, {color: 'red'}).addTo(map_1617e99debc67710a7a59084ddc2d0eb);
            map_1617e99debc67710a7a59084ddc2d0eb.panTo(new L.LatLng(lat, lng));
        }
        function handleLocationError(error) {
            console.error('Location error:', error);
        }
        function startTracking() {
            if (navigator.geolocation && !watchId) {
                watchId = navigator.geolocation.watchPosition(
                    handleLocationUpdate, 
                    handleLocationError, 
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            }
        }
        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }
        // チェックボックスを地図に追加
        const trackingControl = L.control({ position: 'topright' });
        trackingControl.onAdd = function(map) {
            const div = L.DomUtil.create('div', '');
            const checkbox = L.DomUtil.create('input', '', div);
            checkbox.type = 'checkbox';
            checkbox.id = 'trackingCheckbox';
            checkbox.style.margin = '5px';
            const label = L.DomUtil.create('label', '', div);
            label.htmlFor = 'trackingCheckbox';
            label.innerHTML = '位置追跡';
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    startTracking();
                } else {
                    stopTracking();
                }
            });
            return div;
        };
        trackingControl.addTo(map_1617e99debc67710a7a59084ddc2d0eb);
        // GeoJSONとして保存する関数
        function downloadGeoJSON() {
            if (path.length === 0) {
                alert("まだ位置データがありません");
                return;
            }
            const geojson = {
                type: "Feature",
                geometry: {
                    type: "LineString",
                    coordinates: path.map(coord => [coord[1], coord[0]])  // [lng, lat]
                },
                properties: {
                    timestamp: new Date().toISOString()
                }
            };
            const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "path.geojson";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        // ダウンロードボタンを地図に追加
        const downloadButton = L.control({ position: 'topright' });
        downloadButton.onAdd = function(map) {
            const btn = L.DomUtil.create('button', '');
            btn.innerHTML = 'Download GeoJSON';
            btn.style.backgroundColor = 'white';
            btn.style.padding = '5px';
            btn.style.cursor = 'pointer';
            btn.style.margin = '5px';
            btn.onclick = downloadGeoJSON;
            return btn;
        };
        downloadButton.addTo(map_1617e99debc67710a7a59084ddc2d0eb);
        
</script>
</html>