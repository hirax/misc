<!DOCTYPE html>
<html>
<head>
    <title>京都歴史散歩地図 2025/07/20</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
        <script>
            L_NO_TOUCH = false;
            L_DISABLE_3D = false;
        </script>
    
    <style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
    <style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_b9893115cf9e63ebfd4fd8f2e002bcaf {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>
        
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-locatecontrol/0.66.2/L.Control.Locate.min.css"/>
</head>
<body>
    
    
            <div class="folium-map" id="map_b9893115cf9e63ebfd4fd8f2e002bcaf" ></div>
        
    
        <div style="position:absolute; bottom:20px; 
        right:10px; z-index:1000; background:
        rgba(255,255,255,0.9); padding:10px;">
            <input id="slide" type="range" 
            min="0" max="1" step="0.1" value="1" 
            onchange="updateOpacity(this.value)">
        </div>
        
    
        <input type="file" accept=".geojson,.json" 
        style="position:absolute; top:10px; 
        left:200px; z-index:1000;">
        
</body>
<script>
    
    
            var map_b9893115cf9e63ebfd4fd8f2e002bcaf = L.map(
                "map_b9893115cf9e63ebfd4fd8f2e002bcaf",
                {
                    center: [35.0116, 135.768],
                    crs: L.CRS.EPSG3857,
                    zoom: 13,
                    zoomControl: true,
                    preferCanvas: false,
                }
            );
            L.control.scale().addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);

            

        
    
            var tile_layer_e2854149970df5f75db0f37e4ce79f8b = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors", "detectRetina": false, "maxNativeZoom": 19, "maxZoom": 20, "minZoom": 11, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            tile_layer_e2854149970df5f75db0f37e4ce79f8b.addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
        
    
            var tile_layer_8fa84d2de80f74bc7a2c207ae63c12aa = L.tileLayer(
                "https://api.rekichizu.jp/tiles/inou-2024-1125/{z}/{x}/{y}",
                {"attribution": "\u308c\u304d\u3061\u305a/\u30c7\u30b8\u30bf\u30eb\u4f0a\u80fd\u56f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_29976183b876f57b990c82c97c4f7c25 = L.tileLayer(
                "https://www.dmuchgis.com/wmts/meisai_hasegawa/{z}/{x}/{y}.png",
                {"attribution": "ArcGIS\u30aa\u30f3\u30e9\u30a4\u30f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_e7d0ed1f7a137641579436c79f8d32be = L.tileLayer(
                "https://www.dmuchgis.com/wmts/meisai_sougou/{z}/{x}/{y}.png",
                {"attribution": "ArcGIS\u30aa\u30f3\u30e9\u30a4\u30f3", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_213decbc1c7d3844395d16d4daad173f = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/kasei/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_fecdf30cd5eb7245ce0f301c982805c9 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/seisiki/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_72d461c8409e81fe41efe2770df168e0 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s4/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_dec6f1c8995e038f595d24a0b7d6554e = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s10/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_c7555fadb6017bae7d4736069149a588 = L.tileLayer(
                "https://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/geo/maps/s28/{z}/{x}/{y}.png",
                {"attribution": "\u8fd1\u4ee3\u4eac\u90fd\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30de\u30c3\u30d7", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": true}
            );
        
    
            var tile_layer_947203861b18475cf90ea2347cbff399 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/hillshademap/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_2f3beea7d2e824bec888d7847df44b4e = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/ort_USA10/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_15e663f38a8892ee60963979d73d37c8 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/gazo1/{z}/{x}/{y}.jpg",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_f8c02b271730a98159a8f7a378d9ca78 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662+GRUS\u753b\u50cf\uff08\u00a9 Axelspace\uff09", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_f0d055a6ca2f6b529a0ae37490bfd537 = L.tileLayer(
                "https://cyberjapandata.gsi.go.jp/xyz/afm/{z}/{x}/{y}.png",
                {"attribution": "\u56fd\u571f\u5730\u7406\u9662", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_aff08d098d9573409ddd9af87b715f2a = L.tileLayer(
                "https://www.j-shis.bosai.go.jp/map/xyz/landslide/{z}/{x}/{y}.png",
                {"attribution": "\u9632\u707d\u79d1\u5b66\u6280\u8853\u7814\u7a76\u6240", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    
            var tile_layer_e12dca0a31841e6a342031f5c3984311 = L.tileLayer(
                "https://gbank.gsj.jp/seamless/v2/api/1.3.1/tiles/{z}/{y}/{x}.png",
                {"attribution": "\u7523\u7dcf\u7814\u5730\u8cea\u8abf\u67fb\u7dcf\u5408\u30bb\u30f3\u30bf\u30fc", "detectRetina": false, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1.0, "subdomains": "abc", "tms": false}
            );
        
    

            var geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71 = {"collapsed": false, "defaultMarkGeocode": true, "position": "topright", "provider": "nominatim", "providerOptions": {}, "zoom": 11};

            // note: geocoder name should start with lowercase
            var geocoderName_geocoder_e9a41638d6b26bfd9e82252fb2b78f71 = geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71["provider"];

            var customGeocoder_geocoder_e9a41638d6b26bfd9e82252fb2b78f71 = L.Control.Geocoder[ geocoderName_geocoder_e9a41638d6b26bfd9e82252fb2b78f71 ](
                geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71['providerOptions']
            );
            geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71["geocoder"] = customGeocoder_geocoder_e9a41638d6b26bfd9e82252fb2b78f71;

            L.Control.geocoder(
                geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71
            ).on('markgeocode', function(e) {
                var zoom = geocoderOpts_geocoder_e9a41638d6b26bfd9e82252fb2b78f71['zoom'] || map_b9893115cf9e63ebfd4fd8f2e002bcaf.getZoom();
                map_b9893115cf9e63ebfd4fd8f2e002bcaf.setView(e.geocode.center, zoom);
            }).addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);

        
    
            var layer_control_326ced18d562fb4d0350eda797d11599_layers = {
                base_layers : {
                    "openstreetmap" : tile_layer_e2854149970df5f75db0f37e4ce79f8b,
                },
                overlays :  {
                    "\u308c\u304d\u3061\u305a/\u30c7\u30b8\u30bf\u30eb\u4f0a\u80fd\u56f3" : tile_layer_8fa84d2de80f74bc7a2c207ae63c12aa,
                    "ArcGIS\u662d\u548c2\u5e74\u9803\u4eac\u90fd\u5e02\u660e\u7d30\u56f3(\u9577\u8c37\u5ddd\u5bb6\u7248)\u3010around 1926\u3011" : tile_layer_29976183b876f57b990c82c97c4f7c25,
                    "ArcGIS\u662d\u548c26\u5e74\u9803\u4eac\u90fd\u5e02\u660e\u7d30\u56f3\uff08\u4eac\u90fd\u5b66\u30fb\u6b74\u5f69\u9928\uff09\u3010around 1951\u3011" : tile_layer_e7d0ed1f7a137641579436c79f8d32be,
                    "\u660e\u6cbb25\u5e74(\u4eee\u88fd\u56f3)\u30101892\u3011" : tile_layer_213decbc1c7d3844395d16d4daad173f,
                    "\u5927\u6b63\u5143\u5e74(\u6b63\u5f0f\u56f3)\u30101912\u3011" : tile_layer_fecdf30cd5eb7245ce0f301c982805c9,
                    "\u662d\u548c4\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101929\u3011" : tile_layer_72d461c8409e81fe41efe2770df168e0,
                    "\u662d\u548c10\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101935\u3011" : tile_layer_dec6f1c8995e038f595d24a0b7d6554e,
                    "\u662d\u548c28\u5e74(\u90fd\u5e02\u8a08\u753b)\u30101953\u3011" : tile_layer_c7555fadb6017bae7d4736069149a588,
                    "\u9670\u5f71\u8d77\u4f0f\u56f3" : tile_layer_947203861b18475cf90ea2347cbff399,
                    "\u7a7a\u4e2d\u5199\u771f\uff081945\u5e74\uff5e1950\u5e74\uff09" : tile_layer_2f3beea7d2e824bec888d7847df44b4e,
                    "\u7a7a\u4e2d\u5199\u771f\uff081974\u5e74\uff5e1978\u5e74\uff09" : tile_layer_15e663f38a8892ee60963979d73d37c8,
                    "\u5168\u56fd\u6700\u65b0\u5199\u771f(\u30b7\u30fc\u30e0\u30ec\u30b9)" : tile_layer_f8c02b271730a98159a8f7a378d9ca78,
                    "\u6d3b\u65ad\u5c64\u56f3\uff08\u90fd\u5e02\u570f\u6d3b\u65ad\u5c64\u56f3\uff09" : tile_layer_f0d055a6ca2f6b529a0ae37490bfd537,
                    "\u5730\u3059\u3079\u308a\u5730\u5f62\u5206\u5e03\u56f3\u65e5\u672c\u5168\u56fd\u7248" : tile_layer_aff08d098d9573409ddd9af87b715f2a,
                    "\u5730\u8cea\u56f3" : tile_layer_e12dca0a31841e6a342031f5c3984311,
                },
            };
            let layer_control_326ced18d562fb4d0350eda797d11599 = L.control.layers(
                layer_control_326ced18d562fb4d0350eda797d11599_layers.base_layers,
                layer_control_326ced18d562fb4d0350eda797d11599_layers.overlays,
                {"autoZIndex": true, "collapsed": true, "position": "topright"}
            ).addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);

        
    
            var locate_control_a07dfb4a325a8106106d42d57417343d = L.control.locate(
                {}
            ).addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
            
        
    
        function updateOpacity(value) {
            
            tile_layer_8fa84d2de80f74bc7a2c207ae63c12aa.setOpacity(value);
            
            tile_layer_29976183b876f57b990c82c97c4f7c25.setOpacity(value);
            
            tile_layer_e7d0ed1f7a137641579436c79f8d32be.setOpacity(value);
            
            tile_layer_213decbc1c7d3844395d16d4daad173f.setOpacity(value);
            
            tile_layer_fecdf30cd5eb7245ce0f301c982805c9.setOpacity(value);
            
            tile_layer_72d461c8409e81fe41efe2770df168e0.setOpacity(value);
            
            tile_layer_dec6f1c8995e038f595d24a0b7d6554e.setOpacity(value);
            
            tile_layer_c7555fadb6017bae7d4736069149a588.setOpacity(value);
            
            tile_layer_947203861b18475cf90ea2347cbff399.setOpacity(value);
            
            tile_layer_2f3beea7d2e824bec888d7847df44b4e.setOpacity(value);
            
            tile_layer_15e663f38a8892ee60963979d73d37c8.setOpacity(value);
            
            tile_layer_f8c02b271730a98159a8f7a378d9ca78.setOpacity(value);
            
            tile_layer_f0d055a6ca2f6b529a0ae37490bfd537.setOpacity(value);
            
            tile_layer_aff08d098d9573409ddd9af87b715f2a.setOpacity(value);
            
            tile_layer_e12dca0a31841e6a342031f5c3984311.setOpacity(value);
            
        }
        
    
        var input=document.querySelector('input[type="file"]');
        input.addEventListener('change', function(e) {
            var file = e.target.files[0];
            if (!file) return;
            var reader = new FileReader();
            reader.onload = function(e) {
            try {
            var geojsonData = JSON.parse(e.target.result);
                    L.geoJSON(geojsonData, {
                        style: function(feature) {
                            return {
                                fillColor: 'blue',
                                color: 'blue',
                                weight: 5,
                                fillOpacity: 0.8
                            };
                        }
                    }).addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
                } catch (error) {
                    alert(error.message);
                }
            };
            reader.readAsText(file);
        });
        
    
        let path = [];
        let watchId = null;
        function handleLocationUpdate(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const timestamp = new Date().toISOString();
            path.push([lat, lng]);
            const polyline = L.polyline(path, {color: 'red'}).addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
            map_b9893115cf9e63ebfd4fd8f2e002bcaf.panTo(new L.LatLng(lat, lng));
        }
        function handleLocationError(error) {
            console.error('Location error:', error);
        }
        function startTracking() {
            if (navigator.geolocation && !watchId) {
                watchId = navigator.geolocation.watchPosition(
                    handleLocationUpdate, 
                    handleLocationError, 
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            }
        }
        function stopTracking() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }
        // チェックボックスを地図に追加
        const trackingControl = L.control({ position: 'topright' });
        trackingControl.onAdd = function(map) {
            const div = L.DomUtil.create('div', '');
            const checkbox = L.DomUtil.create('input', '', div);
            checkbox.type = 'checkbox';
            checkbox.id = 'trackingCheckbox';
            checkbox.style.margin = '5px';
            const label = L.DomUtil.create('label', '', div);
            label.htmlFor = 'trackingCheckbox';
            label.innerHTML = '位置追跡';
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    startTracking();
                } else {
                    stopTracking();
                }
            });
            return div;
        };
        trackingControl.addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
        // GeoJSONとして保存する関数
        function downloadGeoJSON() {
            if (path.length === 0) {
                alert("まだ位置データがありません");
                return;
            }
            const geojson = {
                type: "Feature",
                geometry: {
                    type: "LineString",
                    coordinates: path.map(coord => [coord[1], coord[0]])  // [lng, lat]
                },
                properties: {
                    timestamp: new Date().toISOString()
                }
            };
            const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "path.geojson";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        // ダウンロードボタンを地図に追加
        const downloadButton = L.control({ position: 'topright' });
        downloadButton.onAdd = function(map) {
            const btn = L.DomUtil.create('button', '');
            btn.innerHTML = 'Download GeoJSON';
            btn.style.backgroundColor = 'white';
            btn.style.padding = '5px';
            btn.style.cursor = 'pointer';
            btn.style.margin = '5px';
            btn.onclick = downloadGeoJSON;
            return btn;
        };
        downloadButton.addTo(map_b9893115cf9e63ebfd4fd8f2e002bcaf);
        
</script>
</html>